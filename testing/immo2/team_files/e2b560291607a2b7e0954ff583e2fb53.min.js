function setCollapse(items){$(items).off().on('click',function(event){event.preventDefault();var par=$(this).parents('.collapse:eq(0)');if(par.hasClass('collapse_active')){par.toggleClass('collapse_active');par.parents('.team__list:eq(0)').find(">.team__item_faded").removeClass('team__item_faded');$(".referal_"+par.data('referal')).removeClass('team__item_faded')}else{$('.collapse_active.referal_'+par.data('referal')).removeClass('collapse_active');par.toggleClass('collapse_active').removeClass('team__item_faded');$(this).trigger('collapse')}});$(items).on('collapse',function(){var id=$(this).data('id');if($(this).parents('.collapse').hasClass('collapse_active')){$(this).parents('.team__list').find('.team__item:not(.collapse_active)').addClass('team__item_faded');console.log($(this));$.post("/ajax.php",{module:'team',act:'get_folowers',dataType:'json',uid:$(this).data('id')},function(data){html="";for(var i in data.list){html+=data.list[i]}
$('#user_'+id+' .team__list').html(html);$('#user_'+id+' .team__list .tip[title]').colorTip({color:'black'});setCollapse('.referal_'+id+" .collapse__handler")},'json')}else{$(this).parents('.team__list').find(">.team__item_faded").removeClass('team__item_faded');$('.referal_'+id).remove()}});detailse_On_activate()}
function VerifyConfirm(id){swal({title:$GL('team_verify_confirme:Вы действительно хотите верифицировать пользователя?'),showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:$GL("yes:Да"),cancelButtonText:$GL("No:Нет"),},function(){$('body').addClass("load");$.post("/ajax.php",{module:'team',dataType:'json',act:'virifyConfirm',id:id},function(data){$('body').removeClass('load');if(data.result=='success'){$('#verify_'+id).addClass('success')
setTimeout(function(){$('#verify_'+id).remove();if($('.verify__list__item').length==0){$('.verify_wrap').remove()}},1000)}else{}},'json')})}
function VerifyReject(id){swal({title:$GL('team_verify_rejecte:Вы действительно хотите отклонить заявку?'),showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:$GL("yes:Да"),cancelButtonText:$GL("No:Нет"),},function(){$('body').addClass("load");$.post("/ajax.php",{module:'team',dataType:'json',act:'virifyReject',id:id,comment:$('#verify_comment_'+id).val()},function(data){$('body').removeClass('load');if(data.result=='success'){$('#verify_'+id).addClass('success')
setTimeout(function(){$('#verify_'+id).remove();if($('.verify__list__item').length==0){$('.verify_wrap').remove()}},1000)}else{}},'json')})}
function detailse_On_activate(){$('.details__textarea').off().on('change',function(){$('body').addClass('load');$.post("/ajax.php",{module:'team',dataType:'json',act:'addComment',id:$(this).data('id'),comment:$(this).val()},function(){$('body').removeClass('load')})})}
function getIserInfo(id){$('body').addClass('load');$.post("/ajax.php",{module:'team',act:'getUserInfo',id:id,dataType:'json'},function(data){$('body').removeClass('load');MY_OVERLAY.active(data.response);detailse_On_activate();$('input[name=call_status]').on('change',function(){$('body').addClass('load');var ti=$('#team_info_'+id);ti.removeClass('call_status_'+ti.data('callstatus'));ti.addClass('call_status_'+$(this).val());ti.data('callstatus',$(this).val());$.post("/ajax.php",{module:'team',act:'callStatus',dataType:'json',follower_id:id,status:$(this).val()},function(){$('body').removeClass('load')},'json')})},'json')}
function sendMessage(id){$('body').addClass('load');$.get("/index.php?module=account&act=messages&id="+id+"&responseType=popup",{},function(data){$('body').removeClass('load');MY_OVERLAY.active(data)})}
function sendShowPayPage(id){$('body').addClass('load');$.post("/ajax.php",{module:'team',dataType:'json',act:'showpay_page',id:id},function(data){$('body').removeClass('load');if(data.response==1){$('#payPage_btn_'+id).remove();swal($GL('sucess:успешно'),'','success')}},'json')}
function ShowNoticeSendForm(){MY_OVERLAY.active($('#tmpl-notice-sendform').tmpl().html());MY_OVERLAY.tinymce=tinymce.init({selector:'.editor',height:500,theme:'modern',plugins:['advlist autolink lists link image jbimages charmap preview hr anchor pagebreak','searchreplace wordcount visualblocks visualchars','insertdatetime media nonbreaking save table contextmenu directionality','emoticons template paste textcolor colorpicker textpattern imagetools'],toolbar1:'insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image jbimages',toolbar2:'print preview media | forecolor backcolor',image_advtab:!0,invalid_elements:"script",cleanup:!0,height:300,templates:[],content_css:[]});$('#team_noticesend_btn').on('click',function(){var title=$('#team_notice_title').val();var descr=tinyMCE.activeEditor.getContent();if(title==''&&0){swal({title:$GL('notice_set_title:Введите заголовок'),type:'error'})}else if(descr==''){swal({title:$GL('notice_set_descr:Введите текст уведомления'),type:'error'})}else{$('body').addClass('load');$.post("/ajax.php",{module:'notice',act:'createTeamNotice',title:title,text:descr,dataType:'json'},function(data){$('body').removeClass('load');if(data.result=='success'){tinyMCE.activeEditor.destroy();MY_OVERLAY.close();swal({title:$GL('nitice_message_sended:Сообщение успешно отправлено'),type:'success'})}},'json')}})}
$(document).ready(function(){var lvls=parseInt($('#has_lvl').text());$("#deep-range").slider({range:!0,min:1,max:lvls,values:[parseInt($('#deep_from').val()),parseInt($('#deep_to').val())],slide:function(event,ui){$("#deep_from").val(ui.values[0]);$("#deep_to").val(ui.values[1])}});$('#deep_from').on('change',function(){var l=parseInt($(this).val());if(!l)
l=1;$(this).val(l);$("#deep-range").slider("values",0,l)});$('#deep_to').on('change',function(){var l=parseInt($(this).val());if(!l)
l=lvls;$(this).val(l);$("#deep-range").slider("values",1,l)});$.datepicker.setDefaults($.datepicker.regional.ru);$('input[type=date],.date__input,.input__date').datetimepicker({dateFormat:'yy-mm-dd',language:'ru'});$('.form__switcher').on('click',function(){var switcher=$(this);console.log(switcher);console.log('@');switcher.find('.ison').prop({'checked':!1}).removeClass('checked');switcher.find('.isoff').prop({'checked':!1}).removeClass('checked');console.log(switcher.find('input:checked'));if(!switcher.hasClass('active-checked')&&!switcher.hasClass('disactive-checked')){console.log(1);console.log(switcher.find('input:checked'));switcher.addClass('active-checked');switcher.find('.ison').prop({'checked':!0}).addClass('checked')}else if(switcher.hasClass('active-checked')){console.log(2);console.log(switcher.find('input:checked'));switcher.removeClass('active-checked');switcher.addClass('disactive-checked');switcher.find('.isoff').prop({'checked':!0}).addClass('checked')}else if(switcher.hasClass('disactive-checked')){console.log(3);console.log(switcher.find('input:checked'));switcher.removeClass('disactive-checked');switcher.removeClass('active-checked');switcher.find('.ison,.isoff').prop({'checked':!1}).removeClass('checked')}
console.log(switcher.find('input:checked'));var filter=$('#filter').serialize();console.warn(decodeURIComponent(filter));$('#filter_trigger').trigger("change")});$('#open_line_input').keyup(function(e){var keyCode=e.which!=0?e.which:e.keyCode;if(keyCode==13){Team.open_line()}});setCollapse('.collapse__handler');$('#team_search_area').keyup(function(e){var keyCode=e.which!=0?e.which:e.keyCode;if(keyCode==13){$('#team_search_btn').trigger('click')}});$('#team_search_btn').on('click',function(e){e.preventDefault()
Team.search()});$('#filter input:not(.ison):not(.isoff)').on("change",function(){Team.search()});$('.datepicker').datepicker({dateFormat:'yy-mm-dd'});if($('body').colorTip){$('.tip[title]').colorTip({color:'black'})}
if(typeof ZeroClipboardCreate!='undefined')
ZeroClipboardCreate('.clipboard-btn')});Team={search:function(){var str=$('#team_search_area').val();var filter=$('#filter').serialize();console.info(decodeURIComponent(filter));if(str!=''||decodeURIComponent(filter)!='filter[reg_from]=&filter[reg_to]=&filter[deep_from]=1&filter[deep_to]=8'){$('body').addClass('load');if(typeof Team.xhr!='undefined'){Team.xhr.abort()}
$('#jump').hide();Team.xhr=$.post("/ajax.php",{module:'team',act:'team_search',dataType:'json',query:str,filter:filter},function(data){$('body').removeClass('load');$('body').removeClass('load');html="";for(var i in data.list){html+=data.list[i]}
$('#main_team__list').html(html);if($('body').colorTip){$('.tip[title]').colorTip({color:'black'})}
setCollapse('.collapse__handler');$('#pagination_wrap').html(data.pages);$('#find_count').text(data.total_count);$('#find_counter').show()},'json')}else{$('#open_line_input').val(1);Team.open_line()}},open_line:function(){$('body').addClass('load');$('#jump').show();$.post("/ajax.php",{module:'team',act:'open_line',dataType:'json',line:$('#open_line_input').val()},function(data){$('body').removeClass('load');$('#find_counter').hide();html="";for(var i in data.list){html+=data.list[i]}
$('#find_count').text(data.total_count);$('#main_team__list').html(html);$('.tip[title]').colorTip({color:'black'});setCollapse('.collapse__handler');$('#pagination_wrap').html(data.pages)},'json')},sendBalance:function(id){swal({title:$GL('balance_do_send_balance:Вы действительно хотите отправить средства?'),showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:$GL("yes:Да"),cancelButtonText:$GL("No:Нет"),cancelFunction:function(){}},function(){$('body').addClass("load");$.post("/ajax.php",{module:'balance',dataType:'json',act:'sendBalance',toid:id,amount:$('#book_transfer_amount').val()},function(data){$('body').removeClass('load');if(data.result=='success'){swal({title:$GL("balance_success_sendbalance:Вы успешно перевели средства!"),type:'success'})}else{swal({title:data.error_mes,type:'error'})}},'json')})},changeSponsor:function(id){if($('#book_change_sponsor').val()){swal({title:$GL('tema_realy_change_sponsor:Вы действительно хотите изменить спонсора?'),description:$GL("team_change_sponsor_desc:Изменения коснуться всех партнеров данного пользователя"),showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:$GL("yes:Да"),cancelButtonText:$GL("No:Нет"),cancelFunction:function(){}},function(){$('body').addClass("load");$.post("/ajax.php",{module:'team',dataType:'json',act:'changeSponsor',toid:id,email:$('#book_change_sponsor').val()},function(data){$('body').removeClass('load');if(data.result=='success'){swal({title:$GL("team_success_change_sponsor:Вы успешно изменили спонсора!"),type:'success'})}else{swal({title:data.error_mes,type:'error'})}},'json')})}else{swal({title:$GL('team_change_sponsor'),type:'error'})}}}