//SHOW ADDITIONAL AUTH WAYSjQuery('.show_add_auth').on('click', function(){    jQuery('.add_auth').toggleClass('hidden');});/*---LEFT BAR ACCORDION----*/$(function() {    $('#nav-accordion').dcAccordion({        eventType: 'click',        autoClose: true,        saveState: true,        disableLink: true,        speed: 'slow',        showCount: false,        autoExpand: true,//        cookie: 'dcjq-accordion-1',        classExpand: 'dcjq-current-parent'    });		$('[data-toggle="tooltip"]').tooltip();	$('[data-toggle="popover"]').popover();});var Script = function () {// sidebar dropdown menu auto scrolling    $('#sidebar .sub-menu > a').click(function () {        var o = ($(this).offset());        diff = 250 - o.top;        if(diff>0)            $("#sidebar").scrollTo("-="+Math.abs(diff),500);        else            $("#sidebar").scrollTo("+="+Math.abs(diff),500);    });// sidebar toggle    $(function() {        function responsiveView() {            var wSize = $(window).width();            if (wSize <= 768) {				$('#sidebar').css({'margin-left': '-200px'});                $('#sidebar > ul').hide();				$('#main-content').css({'margin-left': '0px'});            }            if (wSize > 768) {				$('#sidebar').css({'margin-left': '0'});                $('#sidebar > ul').show();				$('#main-content').css({'margin-left': '200px'});            }        }        $(window).on('load', responsiveView);        $(window).on('resize', responsiveView);    });    $('.fa-bars').click(function () {			var wSize = $(window).width();        if ($('#sidebar > ul').is(":visible") === true) {            $('#sidebar').css({'margin-left': '-200px'});            $('#sidebar > ul').hide();			if(wSize > 768){				$('#main-content').css({'margin-left': '0px'});			}        } else {            $('#sidebar').css({'margin-left': '0'});            $('#sidebar > ul').show();			if(wSize > 768){				$('#main-content').css({'margin-left': '200px'});			}        }    });// widget tools    $('.panel .tools .fa-chevron-down').click(function () {        var el = $(this).parents(".panel").children(".panel-body");        if ($(this).hasClass("fa-chevron-down")) {            $(this).removeClass("fa-chevron-down").addClass("fa-chevron-up");            el.slideUp(200);        } else {            $(this).removeClass("fa-chevron-up").addClass("fa-chevron-down");            el.slideDown(200);        }    });    $('.panel .tools .fa-times').click(function () {        $(this).parents(".panel").parent().remove();    });// tool tips$('.tooltips').tooltip();// popovers$('.popovers').popover();}();// generator pay formfunction post_open_url(url, post) {	var form = $('<form/>', {		action: url,		method: 'POST',		style: {		   display: 'none'		}	});	for(var key in post) {		form.append($('<input/>',{			type: 'hidden',			name: key,			value: post[key]		}));	}	form.appendTo(document.body);	form.submit();}// get balance	// var ud = {'.user_data .credit':'credits', '.user_data .money':'money'};	// get_user_data(ud);function get_user_data(obj, sub){	var sub = (!sub) ? 'user': sub;	var obj = (!obj || obj == 0) ? {}: obj;	var data = {action:'ajax_check', sub:sub, data:obj};	$.ajax({		url : "/ajax/action.php",		type : "post",		dataType: 'json',		data: data,		success : function(result){			data = result.resp.data;			if(result.resp.error == false && data != null){				$.each(data, function(i, item){					$(item.selector).html(item.content);				});			}					}	});}// GEOfunction Proper(childs, parent){	this.childs = childs;	this.parent = parent;	this.eacher = function(){		var obj = this;		var check = false;		obj.parent.prop('checked', check);				$(obj.childs).each(function(i){			check = $(this).prop("checked");			if(check){				obj.parent.prop('checked', check);				return false;			}		});	}};// count all visitsfunction geoAllVisits(form){	var cnt = 0;	var test = {};	var except = {};	var staff = ['all','all_ru','all_ua','all_countries','geo_ru_regions','geo_ua_regions','geo__eur','geo__sng','geo__other','region_9998','region_9999'];	var except_name = {'geo_ru_regions':'ru', 'geo_ua_regions':'ua'};	//var form = $('form[name="site_settings_save_geotargeting"]');	var collection = form.find('input[data-staff="geo"]');		$.each(collection, function(i, item){		var visit = 0;		var inp = $(item);		var name = inp.attr('name');				if(!inp.prop('checked')){			return;		}				if(except_name[name] != undefined){			except[name] = form.find('input[data-state="' +except_name[name]+ '"]').parents('li').find('span.badge').text();		}				if( 0 > $.inArray(name, staff)){			visit = inp.parents('li').find('span.badge').text();			cnt += visit * 1;		}	});			for(var key in except){		var deff = except[key];		if(deff > 0){			cnt -= except[key];		}			}	return cnt;	//form.find('.geo-all-visits').removeClass('hidden').find('.count-visits').text(cnt);};function geoSinchronizeRegion(box){	var cnt = 0;	var countries = box.parents('.geo_targeting_box').find('.countries');	var collection = box.find('li:not(.hidden) span.badge');		//console.log(box);	$.each(collection, function(i, item){		var val = $(item).html();		cnt += val * 1;		//console.log(cnt, val);	});		if(cnt > 0){		box.prev('ul').find('span.badge').html(cnt);				if(box.hasClass('geo_ua')){			var reg_inp = 'geo_ua';		}		if(box.hasClass('geo_ru')){			var reg_inp = 'geo_ru';		}		if(reg_inp){			countries.find('input[name="'+reg_inp+'"]').parents('li').find('span.badge').html(cnt);		}			}};function allChecker(box){		var inp_all = $('input[name="all"]');	var inp_all_ru = $('input[name="all_ru"]');	var inp_all_ua = $('input[name="all_ua"]');		inp_all.val('all');	box.find(' .country_box input').each(function(){		if(!$(this).prop("checked")){			inp_all.val(0);		}else{			if($(this).hasClass('other')){				$(this).removeClass('hidden');			}		}	});	inp_all_ru.val('all');	box.find(' .geo_ru_regions input').each(function(){		if(!$(this).prop("checked")){			inp_all_ru.val(0);		}else{			if($(this).hasClass('other')){				$(this).removeClass('hidden');			}		}	});	inp_all_ua.val('all');	box.find(' .geo_ua_regions input').each(function(){		if(!$(this).prop("checked")){			inp_all_ua.val(0);		}else{			if($(this).hasClass('other')){				$(this).removeClass('hidden');			}		}	});}$('.geo_targeting_box').find(' .geo_ru_regions input').each(function(){	if($(this).prop("checked")){		if($(this).hasClass('other')){			$(this).removeClass('hidden');		}	}});$('.geo_targeting_box').find(' .geo_ua_regions input').each(function(){	if($(this).prop("checked")){		if($(this).hasClass('other')){			$(this).removeClass('hidden');		}	}}); // other viewfunction otherView(e){	var eto = $(e);	var key = eto.attr('data-key');	var el = eto.parents('ul').find('li.'+key);		eto.find('i').toggleClass('fa-plus-square fa-minus-square');	el.toggleClass("hidden");		// Удаляем и восстанавливаем	var col_det = el.detach();	eto.parents('li').after(col_det);} // on/off other regionsfunction onRegions(e){	var eto = $(e);	var code = eto.attr('data-code');	var name = eto.attr('name');	var hasOther = eto.parents('li').hasClass('other');	var hasSng = eto.parents('li').hasClass('sng');	var hasEur = eto.parents('li').hasClass('eur');	var hasCountry = eto.parents('ul').hasClass('country_box');	var check = eto.prop("checked");	var form = eto.parents('form');		var box = form.find('.geo_targeting_box');		//	var parent_countries = box.find('input[name="all_countries"]');		var parent_regions_ru = box.find('.country_box input[name="geo_ru"]');	var parent_regions_ru_d = box.find('.geo_ru  input[name="geo_ru_regions"]');	var child_regions_ru = box.find('.geo_ru input[type="checkbox"]');		var parent_regions_ua = box.find('.country_box input[name="geo_ua"]');	var parent_regions_ua_d = box.find('.geo_ua input[name="geo_ua_regions"]');	var child_regions_ua = box.find('.geo_ua input[type="checkbox"]');		//	var countryProper = new Proper(box.find(' input'), parent_countries);	var regionProper_ru = new Proper(child_regions_ru, parent_regions_ru);	var regionProper_ru_d = new Proper(child_regions_ru, parent_regions_ru_d);		var regionProper_ua = new Proper(child_regions_ua, parent_regions_ua);	var regionProper_ua_d = new Proper(child_regions_ua, parent_regions_ua_d);	//		console.log(name, code, check, hasSng);		if(name == 'region_9999' || name == 'region_9998'){		eto.parents('ul').find('li.other input[type="checkbox"]').prop("checked", check);	}	if(code == 'sng' || code == 'eur' || code == 'other'){		eto.parents('ul').find('li.'+ code +' input[type="checkbox"]').prop("checked", check);	}	if(name == 'geo_ru' || name == 'geo_ua' || name == 'geo_ru_regions' || name == 'geo_ua_regions'){		box.find('.'+name+' input[type="checkbox"]').prop("checked", check);	}	if(name == 'all_countries'){		box.find('input[type="checkbox"]').prop("checked", check);	}		// для остальных регионов	if(hasOther && (code == 'RU' || code == 'UA')){		if(code == 'RU'){			var other_inp = 'input[name="region_9998"]';		}		if(code == 'UA'){			var other_inp = 'input[name="region_9999"]';		}		var lower_code = code.toLowerCase();		var othreProper = new Proper(box.find('.geo_'+lower_code+' li.other input[type="checkbox"]'), box.find(other_inp));		othreProper.eacher();	}		// для остальных стран	if( (hasOther || hasSng || hasEur) && hasCountry){		if(hasOther){			var code = 'other';		}		if(hasSng){			var code = 'sng';		}		if(hasEur){			var code = 'eur';		}				var othreProper = new Proper(box.find('.country_box li.'+code+' input[type="checkbox"]'), box.find('input[data-code="'+code+'"]'));		othreProper.eacher();	}		// пересчет	regionProper_ru_d.eacher();	regionProper_ru.eacher();		regionProper_ua_d.eacher();	regionProper_ua.eacher();		countryProper.eacher();			// all	allChecker(box);	var all_visits = geoAllVisits(form);	form.find('.geo-all-visits').removeClass('hidden').find('.count-visits').text(all_visits);}// pattern datefunction patternDate(e){	var e = $(e);	var parent = e.parents('.form-group');	var form = e.parents('form');	var pattern = /[\d]{2}[\.|\/][\d]{2}[\.|\/][\d]{4}[\,\s|\s][\d]{2}[:][\d]{2}/;	//pattern = /^(((0[1-9]|[12]\d|3[01])\.(0[13578]|1[02])\.((19|[2-9]\d)\d{2}))|((0[1-9]|[12]\d|30)\.(0[13456789]|1[012])\.((19|[2-9]\d)\d{2}))|((0[1-9]|1\d|2[0-8])\.02\.((19|[2-9]\d)\d{2}))|(29\.02\.((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00))))$/;	var str = e.val();	var res = pattern.test(str);	if(!res){		//parent.addClass('has-error');		//parent.removeClass('has-success');		//form.find('button').attr('disabled', 'disabled');		//console.log('warning',res, str);	}	else{		//parent.addClass('has-success');		//parent.removeClass('has-error');		//form.find('button').removeAttr('disabled');		//console.log('success',res, str);	}	}$(document).ready(function() {		$('[data-click_selected]').click(function(){		$(this).select();	});		$(".copy_button").on("click", clip); // add element data-clipboard-target="input_id";// custom scrollbar    $("#sidebar").niceScroll({styler:"fb",cursorcolor:"#428bca", cursorwidth: '3', cursorborderradius: '10px', background: '#404040', spacebarenabled:false, cursorborder: ''});    	//$("html").niceScroll({styler:"fb",cursorcolor:"#428bca", cursorwidth: '8', cursorborderradius: '10px', background: '#404040', cursorborder: '', zindex: '1000'});	// resize scroll	/*	$('section.wrapper').on('DOMSubtreeModified', function(){		$("html").getNiceScroll().resize();	});	*/			// check new mail	var data_mailbox = {action:'ajax_mailbox', sub:'new_mail'};	$.ajax({		url : "/ajax/action.php",		type : "post",		dataType: 'json',		data: data_mailbox,		success : function(result){			data = result.resp.data;			if(result.resp.error == false){				if(data.count > 0){					$("#mailbox_menulink").html('Почтовый ящик <span class="badge bg-info" title="Новые письма: '+data.count+'">'+data.count+'</span>');				}			}		}	});		// make read notice	$('.notice-box .bell').click(function(){		var notice_count = $(this).find('.notice-count');		var ul = $('.notice-box ul');		var notices = ul.find('li');		if(notice_count.html() >= 1 || notices.length < 2){				// check list notice 			$.ajax({				url : "/ajax/action.php",				type : "post",				dataType: 'json',				data: {action:'ajax_check', sub:'list_notice'},				success : function(result){					resp = result.resp;										if(resp.error === false){						if(resp.notice.rows.length > 0){														var template = '';							var icon_type = {'info':'fa-info-circle', 'site':'fa-line-chart', 'newsletters':'fa-envelope-o', 'abuse':'fa-ban'};														ul.html('');							notice_count.html('');														$.each(resp.notice.rows, function(i, item){								if(!item.message){									return;								}																var newnotice = '';								if(item.status == 'new'){									newnotice = '<span class="new-notice fa fa-circle"></span>';								}																template += '<li>';									template += '<div class="time small text-muted text-right bg-primary">';										template += '<i class="icon-type fa fa-fw '+icon_type[item.type]+' pull-left"></i>';										template += newnotice;										template += '<time>'+item.time+'</time>';									template += '</div>';									template += '<div class="notice">'+item.message+'</div>';								template += '</li>';															});							ul.append(template);						}					}					else if(resp.error === true){						console.log(resp);					}					else {						template += '<li>';							template += '<div class="time small text-muted text-right bg-primary">';								template += '<i class="icon-type fa fa-fw fa-info-circle hidden-xs pull-left"></i>';								template += newnotice;								template += '<time></time>';							template += '</div>';							template += '<div class="notice">Ошибка в получении уведомлений. Пожалуйста, сообщите в службу поддержки.</div>';						template += '</li>';						ul.append(template);					}				}			});								}		$(".notice-box ul").niceScroll({styler:"fb",cursorcolor:"#428bca", cursorwidth: '4', cursorborderradius: '10px', background: '#404040', spacebarenabled:true, cursorborder: ''});	});		get_user_data(0, 'new_comment');	get_user_data(0, 'new_notice');	get_user_data(0, 'new_helpdesk');			//костыль на процент отказов при добавлении	$('select[name="rejection"]').change(function(){		var rejection = $(this).val();		$('select[name="rejection"] option[value="'+rejection+'"]').attr('selected', 'selected');	});		// Подгружаем слайды	var aside_slider_item = $('.aside_slider .activity-slider');	var data_mailbox = {action:'ajax_slider', sub:'get_slider'};	var aside_slider_cfg = {		//mode: 'fade',        auto: true,        slideSelector: '.activity-slider',        minSlides: 1, maxSlides: 1,        autoHover: true,        pause: 6500, moveSlides: 1,        nextSelector: '.s_next', prevSelector: '.s_prev',        nextText: '', prevText: ''};					aside_slider_item.addClass('hidden');	$.ajax({		url : "/ajax/action.php",		type : "post",		dataType: 'json',		data: data_mailbox,		success : function(result){			data = result.resp.data;			if(result.resp.error === false){				if(data){					var slides = '';					$.each(data, function(i, item){						slides += item;					});					$(".aside_slider").append(slides);					aside_slider_item.removeClass('hidden');					$('.aside_slider').bxSlider(aside_slider_cfg);				}			}		}	});			$('#help_modal form[name="help_phone12"]').submit(function (event) {		var eto = $(this);		var alert = eto.parents('.modal').find('.alert');		var button = eto.find('button.btn');		var data = {};				alert.removeAttr('class').addClass('hidden alert').html('');		button.addClass('progress-bar');				data.phone = eto.find('input[name="phone"]').val();		data.action = 'ajax_help';		data.sub = 'help_phone';				$.ajax({			url : "/ajax/action.php",			type : "post",			dataType: 'json',			data: data,			success : function(result){				button.removeClass('progress-bar').attr('disabled', 'disabled');				if(result.resp.error === false){					alert.addClass('alert-success');				}				if(result.resp.error === true){					alert.addClass('alert-danger');				}								alert.html(result.resp.text).removeClass('hidden');				setTimeout(function(){alert.addClass('hidden')}, 6500);			}		});				return false;			});			$('#help_modal form[name="help_phone"], #help_modal form[name="help_msg"]').submit(function (event) {		var eto = $(this);		var name = eto.attr('name');		var alert = eto.parents('.modal').find('.alert');		var button = eto.find('button.btn');		var data = {};				alert.removeAttr('class').addClass('hidden alert').html('');		button.addClass('progress-bar');				data.action = 'ajax_help';				if(name == 'help_phone'){			data.sub = 'help_phone';			data.phone = eto.find('input[name="phone"]').val();			if(data.phone == ''){				return false;			}		}		if(name == 'help_msg'){			data.sub = 'help_msg';			data.name = eto.find('input[name="name"]').val();			data.msg = eto.find('textarea[name="msg"]').val();			if(data.msg == '' || data.name == ''){				return false;			}		}						$.ajax({			url : "/ajax/action.php",			type : "post",			dataType: 'json',			data: data,			success : function(result){				button.removeClass('progress-bar').attr('disabled', 'disabled');				if(result.resp.error === false){					alert.addClass('alert-success');				}				if(result.resp.error === true){					alert.addClass('alert-danger');				}								alert.html(result.resp.text).removeClass('hidden');				setTimeout(function(){alert.addClass('hidden')}, 6500);			}		});				return false;			});			$('input[data-regexp]').on('keyup click change', function(){		var vld = validationForm();		vld.validateRegExp($(this));		console.log('validate input' + $(this).attr('name'));	});		// send activate mail	$('.send_activate_mail').click(function(){		var resp = $(this).parents('.form-group').find('.resp');				resp.html('<span class="fa fa-cog fa-spin"></span>');		$.ajax({			url : "/ajax/action.php",			type : "post",			dataType: 'json',			data: {action:'ajax_mailings', sub:'send_activate_mail'},			success : function(result){				data = result.resp.data;				if(result.resp.error == false){					resp.html(result.resp.text);				}				if(result.resp.error == true){					resp.html(result.resp.text);				}			}		});	});		// validate form	function validationForm() {		var value;		function v() {}		v.validateRegExp = function (e) {			var fg = e.parents('.form-group');			fg.removeClass('has-error');			value = e.val();			if(value === ''){				return false;			}			var rex = e.data('regexp');			if (value.search(rex) === -1) {				fg.addClass('has-error');			}		};		return v;	};		function clip( e ) {		e.preventDefault();		var area_id = '#' + $(this).data('clipboard-target');		area_id.toString();		var cont = $(area_id).text(), // Or use a custom source Element			$txa = $("<textarea />",{val:cont,css:{position:"fixed"}}).appendTo("body").select(),			$msg = $("#clip-popup");		if(document.execCommand('copy')) $msg.show().delay(1500).fadeOut(); // CH, FF, Edge, IE		else prompt("Copy to clipboard:\nSelect, Cmd+C, Enter", cont); // Saf, Other		$txa.remove();		if (!$(this).hasClass('copy_ref')){			var eto = $(this);			eto.html('<i class="fa fa-check text-success" aria-hidden="true"></i> Скопировано!');			setTimeout(function(){				eto.html('<i class="fa fa-clipboard" aria-hidden="true"></i> Копировать');			}, 1500);		}		else {			var eto = $(this);			eto.html('<i class="fa fa-check text-success" aria-hidden="true"></i>');			setTimeout(function(){				eto.html('<i class="fa fa-clipboard" aria-hidden="true"></i>');			}, 1500);		}		  	}		}); // ready	// animate anything with fadeInfunction fadeIn(elem) {	//console.log('init fadein');	if ($(document).scrollTop() + $(window).height() > $(elem).offset().top && $(document).scrollTop() - $(elem).offset().top < $(elem).height()) {				$(elem).addClass('fadeIn');	}}														